{
  "_ai_instructions": {
    "purpose": "CDD CLI validation tool architecture - how the tool works and how to extend it",
    "when_to_use": "Adding new validators, commands, or understanding validation logic",
    "built_using": "Context-Driven Development methodology on itself (meta!)",
    "related_files": [
      ".github/copilot-instructions.md",
      "bin/cdd.js",
      "src/commands/",
      "src/validators/",
      "README.md"
    ],
    "reading_order": "Start with .github/copilot-instructions.md for quick overview, then read this file for deep dive"
  },
  "last_updated": "2025-11-24T02:55:00Z",
  "overview": {
    "name": "@context-driven-dev/cli",
    "purpose": "Validate and manage Context-Driven Development files",
    "version": "0.1.0",
    "license": "MIT",
    "tech_stack": {
      "runtime": "Node.js 18+",
      "cli_framework": "Commander.js",
      "output_styling": "Chalk (colors), Ora (spinners)",
      "file_globbing": "glob",
      "module_system": "ES modules (type: module)"
    }
  },
  "commands": {
    "init": {
      "signature": "cdd init [path] [--force]",
      "purpose": "Scaffold complete CDD structure with working templates",
      "default_path": ". (current directory)",
      "options": {
        "force": "Overwrite existing files"
      },
      "creates": [
        ".github/copilot-instructions.md - AI entry point with customizable template",
        ".github/DEPENDENCY_GRAPH.json - Context router with example patterns",
        ".github/ai-context/flows/feature_template.json - Implementation flow template",
        ".github/ai-context/schemas/database_models.json - Data model template",
        ".github/ai-context/troubleshooting/anti_patterns.json - Mistakes catalog",
        ".github/ai-context/troubleshooting/decision_trees.json - Debug workflows"
      ],
      "workflow": [
        "Check if .github/ai-context exists (warn if present)",
        "Create directory structure (flows/, schemas/, troubleshooting/, metadata/)",
        "Write template files with current date stamps",
        "Provide next steps guidance"
      ],
      "design_goals": [
        "Zero-friction adoption - works immediately after init",
        "Templates pass validation out of the box",
        "Clear placeholder text guides customization",
        "Demonstrates CDD patterns through examples"
      ],
      "implementation": "src/commands/init.js",
      "implementation_date": "2025-11-24"
    },
    "validate": {
      "signature": "cdd validate [path] [--strict] [--fix]",
      "purpose": "Validate JSON syntax and structure of AI context files",
      "default_path": ".github/ai-context",
      "options": {
        "strict": "Treat warnings as errors (fail build)",
        "fix": "Auto-fix common issues with backup",
        "no-color": "Disable colored output (global flag, for CI/CD)"
      },
      "workflow": [
        "Scan for JSON files using glob pattern",
        "Parse each JSON file",
        "Determine file type (anti_patterns, flows, schemas, dependency_graph)",
        "Run type-specific validator",
        "Collect errors and warnings",
        "Display results with color coding",
        "Exit code 0 (success) or 1 (errors)"
      ],
      "implementation": "src/commands/validate.js"
    },
    "audit": {
      "signature": "cdd audit [path] [--stale-threshold <days>] [--format <format>]",
      "purpose": "Check for stale or outdated context entries",
      "default_threshold": "90 days",
      "checks": [
        "last_updated timestamp in file root",
        "Individual entry dates (e.g., recent_changes[])",
        "Compares against current date minus threshold"
      ],
      "output_formats": [
        "table",
        "json"
      ],
      "workflow": [
        "Scan for JSON files",
        "Parse each file",
        "Check last_updated field",
        "Check individual entry dates (arrays)",
        "Calculate days old",
        "Report entries exceeding threshold",
        "Suggest review/update actions"
      ],
      "implementation": "src/commands/audit.js"
    },
    "analyze-gaps": {
      "signature": "cdd analyze-gaps [path] [--suggest]",
      "purpose": "Identify missing documentation based on codebase analysis",
      "checks": [
        "ai-context directory exists",
        "Critical files present (DEPENDENCY_GRAPH.json, anti_patterns.json)",
        "Component types documented (services, models, controllers)",
        "Coverage gaps between code and context"
      ],
      "workflow": [
        "Scan source files (src/, lib/)",
        "Extract component types",
        "Check if ai-context directory exists",
        "Verify critical files present",
        "Compare source components vs documented flows",
        "Report gaps with severity (high/medium)",
        "Suggest specific actions to fill gaps"
      ],
      "implementation": "src/commands/analyze-gaps.js"
    }
  },
  "validators": {
    "anti_patterns": {
      "file": "src/validators/anti-patterns.js",
      "checks": {
        "required_structure": {
          "anti_patterns": "object - main container",
          "critical_never_do": "array - summary list"
        },
        "per_pattern": {
          "wrong": "string - what not to do (REQUIRED)",
          "correct": "string - what to do instead (REQUIRED)",
          "why_bad": "string - explanation (RECOMMENDED)",
          "impact": "string - consequences (RECOMMENDED)",
          "discovered": "string - date discovered (RECOMMENDED for historical context)"
        }
      },
      "warnings": [
        "Missing critical_never_do array",
        "No anti-patterns defined",
        "Pattern missing why_bad or impact",
        "Pattern missing discovered date"
      ],
      "errors": [
        "Missing anti_patterns object",
        "Pattern missing wrong field",
        "Pattern missing correct field"
      ]
    },
    "flows": {
      "file": "src/validators/flows.js",
      "checks": {
        "_ai_instructions": {
          "purpose": "string - what this flow documents",
          "when_to_use": "string - when AI should load this"
        },
        "flow_steps": "array with step/phase identifiers and descriptions",
        "last_updated": "string - timestamp for staleness tracking"
      },
      "warnings": [
        "Missing _ai_instructions metadata",
        "Missing _ai_instructions.purpose",
        "Missing _ai_instructions.when_to_use",
        "Flow step missing step/phase identifier",
        "Flow step missing description/action",
        "Missing last_updated timestamp"
      ],
      "flexible": "Flow structure varies - warnings only, no hard errors"
    },
    "schemas": {
      "file": "src/validators/schemas.js",
      "checks": {
        "_ai_instructions": "metadata about schema documentation",
        "schema_definitions": "models, schemas, or schema key expected"
      },
      "warnings": [
        "Missing _ai_instructions",
        "No schema definitions found"
      ],
      "flexible": "Schema format varies widely - light validation"
    },
    "dependency_graph": {
      "file": "src/validators/dependency-graph.js",
      "checks": {
        "routing_rules": "object mapping questions to context files",
        "per_route": {
          "file_or_files": "string or array - target context file(s)",
          "keywords": "array - matching keywords (RECOMMENDED)",
          "description": "string - route explanation (RECOMMENDED)"
        }
      },
      "errors": [
        "Missing routing_rules or routes",
        "Route missing target file(s)"
      ],
      "warnings": [
        "Route missing keywords or description"
      ]
    }
  },
  "architecture": {
    "entry_point": "bin/cdd.js",
    "structure": {
      "bin/cdd.js": "CLI entry point - Commander.js program definition",
      "src/commands/": "Command implementations (validate, audit, analyze-gaps)",
      "src/validators/": "Type-specific validation logic",
      "src/utils/": "Shared utilities (future: backup, fix, reporting)",
      "test/": "Unit tests (future: Jest test suites)"
    },
    "module_system": "ES modules - import/export syntax",
    "error_handling": {
      "pattern": "try/catch in commands, return {valid, errors, warnings} from validators",
      "exit_codes": {
        "0": "Success",
        "1": "Validation errors or failures"
      }
    },
    "output_styling": {
      "spinners": "ora for progress indication",
      "colors": "chalk for color coding (green=success, red=error, yellow=warning, cyan=info)",
      "symbols": "\u2713 \u2717 \u26a0 \ud83d\udca1 for visual clarity"
    }
  },
  "extension_patterns": {
    "adding_new_validator": {
      "steps": [
        "Create src/validators/new-type.js",
        "Export function: export function validateNewType(data, file) { return {valid, errors, warnings}; }",
        "Import in src/commands/validate.js",
        "Add conditional check: if (file.includes('new-type')) { result = validateNewType(data, file); }"
      ],
      "example": "src/validators/anti-patterns.js"
    },
    "adding_new_command": {
      "steps": [
        "Create src/commands/new-command.js",
        "Export async function: export async function newCommand(path, options) { ... }",
        "Import in bin/cdd.js",
        "Add Commander.js definition: program.command('new-command').action(newCommand)"
      ],
      "example": "src/commands/audit.js"
    },
    "adding_auto_fix": {
      "pattern": "Backup original \u2192 Detect issue \u2192 Apply fix \u2192 Validate result \u2192 Report changes",
      "future_feature": "Planned for --fix flag",
      "use_cases": [
        "Add missing _ai_instructions",
        "Update last_updated to current date",
        "Format JSON with consistent indentation"
      ]
    }
  },
  "testing_strategy": {
    "unit_tests": {
      "framework": "Jest with ES modules (--experimental-vm-modules)",
      "location": "test/",
      "coverage": [
        "Each validator function",
        "Command argument parsing",
        "Error handling paths"
      ]
    },
    "integration_tests": {
      "method": "Run on real repositories (ClubNeXus, context-driven-dev itself)",
      "verified": "2025-11-24 - ClubNeXus: 12 files, 0 errors, 0 warnings"
    },
    "dogfooding": "Use cdd validate on this repo before each commit (pre-commit hook)"
  },
  "ci_cd_integration": {
    "github_actions": {
      "workflow": ".github/workflows/validate-context.yml",
      "steps": [
        "Checkout code",
        "Setup Node.js",
        "Install CLI: npm install -g @context-driven-dev/cli",
        "Run: cdd validate --strict",
        "Run: cdd audit --stale-threshold 90"
      ],
      "trigger": "pull_request, push to main"
    },
    "pre_commit_hook": {
      "script": ".git/hooks/pre-commit",
      "command": "cdd validate .github/ai-context",
      "exit_on_error": true
    }
  },
  "future_enhancements": {
    "priority_high": [
      "Auto-fix implementation (--fix flag)",
      "JSON schema definitions for each context file type",
      "Better error messages with line numbers"
    ],
    "priority_medium": [
      "Watch mode (continuous validation)",
      "Interactive CLI (select which fixes to apply)",
      "Export validation report to file (JSON, HTML)",
      "Custom validation rules (user-defined schemas)"
    ],
    "priority_low": [
      "VS Code extension integration",
      "Language server protocol (LSP) for real-time validation",
      "Suggested context updates based on git commits",
      "AI-powered gap analysis (OpenAI API integration)"
    ],
    "implemented_features": [
      {
        "feature": "--no-color global flag",
        "implemented_by": "AI #1 responding to AI #2's suggestion",
        "date": "2025-11-24",
        "implementation": "Commander.js preAction hook sets NO_COLOR env + disables chalk",
        "use_case": "CI/CD logs that don't render ANSI escape codes"
      }
    ]
  },
  "meta_lessons": {
    "built_with_cdd": "This CLI was built using the Context-Driven Development methodology it validates",
    "self_documenting": "This file documents the tool that validates this file (meta loop!)",
    "compounding_effect": "Tool improves CDD \u2192 CDD improves tool building \u2192 Better tools faster",
    "autonomous_maintenance": "AI should update this file when CLI changes (autonomous protocol test)",
    "dogfooding_works": "Using the methodology on itself reveals gaps and validates approach",
    "copilot_instructions_created": "2025-11-24 - Added .github/copilot-instructions.md as quick reference layer, this file remains deep dive",
    "ai_to_ai_collaboration_works": "2025-11-24 - AI #2 implemented --json feature and autonomously updated this file without prompting. Protocol validated!",
    "ai_collaboration_iteration_2": "AI #2 implemented --json, suggested --no-color. AI #1 implemented it. Ping-pong collaboration works!",
    "init_command_reduces_friction": "2025-11-24 - Added cdd init to eliminate adoption barriers. Generates working CDD structure in seconds."
  },
  "installation": {
    "from_source": [
      "cd /path/to/context-driven-dev",
      "npm install",
      "npm link (creates global cdd command)"
    ],
    "from_npm": [
      "npm install -g @context-driven-dev/cli (when published)"
    ],
    "verification": [
      "cdd --version",
      "cdd --help",
      "cdd validate (test on current project)"
    ]
  },
  "common_issues": {
    "json_parse_errors": {
      "symptom": "JSON Parse Error in output",
      "cause": "Invalid JSON syntax (trailing commas, missing quotes, etc.)",
      "fix": "Use JSON linter or cdd validate to identify line number"
    },
    "no_files_found": {
      "symptom": "Found 0 context files",
      "cause": "Incorrect path or ai-context not initialized",
      "fix": "Verify path: cdd validate /correct/path/to/ai-context"
    },
    "warnings_in_strict_mode": {
      "symptom": "Exit code 1 even though warnings only",
      "cause": "--strict flag treats warnings as errors",
      "fix": "Fix warnings or remove --strict flag"
    },
    "missing_js_extension": {
      "symptom": "Cannot find module (ES module import)",
      "cause": "ES modules require .js extension in import paths",
      "fix": "Add .js extension: import { x } from './file.js'",
      "critical": "Most common mistake when adding new imports"
    }
  },
  "documentation_structure": {
    "entry_point": ".github/copilot-instructions.md",
    "purpose": "Quick reference for common tasks, critical patterns, and architecture overview",
    "deep_dive": ".github/ai-context/flows/validation_cli.json (this file)",
    "purpose_detail": "Complete implementation details, extension patterns, validation rules",
    "dry_principle": "Copilot instructions references this file for details to avoid duplication",
    "when_to_update": {
      "copilot_instructions": "Change critical patterns, add common tasks, update architecture overview",
      "validation_cli_json": "Add validators, document implementation details, track meta-lessons"
    }
  }
}